# --------------------------------------------------------------
# MakeJNI1
# --------------------------------------------------------------
# 
# GNU Makefile for JNI code
#
# Set some defaults needed in order to create DLL file
# --------------------------------------------------------------

ifndef OS
OS ?= $(shell uname)
OS := $(OS:MINGW%=MINGW)
endif

prefix  := build
OUT 	:= $(prefix)/$(build)
verbose := "Y"

ifndef BIT
BIT := "-m32"
endif

#
# --- MINGW/MSYS has cc defined but is empty
#
ifndef CC
CC := gcc
endif   
ifeq "$(findstring MINGW,$(shell uname))" "MINGW"
CC := gcc
endif

#
# --- Set bit value when using TDM-GCC x64
# --- Force -m32 on x86 systems 
#
TDMGCC := $(shell $(CC) --version)
ifeq "$(findstring tdm64,$(TDMGCC))" "tdm64"
ifneq "$(findstring -m,$(BIT))" "-m"
ifeq "$(findstring 64,$(PROCESSOR_ARCHITEW6432))" "64"
BIT := -m64			
else
BIT := -m32
endif
endif
endif

#
# --- Windows
#
ifeq "$(findstring Windows,$(OS))" "Windows"
CC  	:= $(CC) $(BIT)
WINDRES := windres.exe
CFLAGS  += -std=c99
endif

#
# --- Linux 
#
ifeq "$(findstring Linux,$(OS))" "Linux"
LIBS += -lpthread
CFLAGS += -fPIC -std=c99 -D_POSIX_C_SOURCE
endif

#
# --- Mac 
#
ifeq "$(OS)" "Darwin"
CC := $(CC) $(BIT)
LIBS += -lpthread
CFLAGS += -fPIC -std=c99
endif

#
# --- Omit symbol information on release version
#
ifeq "$(build)" "release"
ifneq "$(OS)" "Darwin"
CC += -s 
endif
endif
