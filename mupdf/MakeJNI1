# --------------------------------------------------------------
# MakeJNI1
# --------------------------------------------------------------
# 
# GNU Makefile for JNI code
#
# Set some defaults needed in order to create DLL file
# --------------------------------------------------------------

ifndef $(OS)
OS ?= $(shell uname)
OS := $(OS:MINGW%=MINGW)
endif

ifndef $(build)
#build   := debug
build   := release
endif

prefix  := build
OUT 	:= $(prefix)/$(build)
verbose := "Y"

ifndef BIT
BIT := ""
endif

#
# --- MINGW/MSYS has cc defined but is empty
#
ifndef CC
CC := gcc
else   
ifeq "$(findstring MINGW,$(shell uname))" "MINGW"
CC := gcc
endif
endif

#
# --- Set bit value when using TDM-GCC x64
# --- Force -m32 on x86 systems 
#
TDMGCC := $(shell $(CC) --version)
ifeq "$(findstring tdm64,$(TDMGCC))" "tdm64"
ifeq "$(findstring x86,$(PROCESSOR_ARCHITECTURE))" "x86"
ifneq "$(findstring -m,$(BIT))" "-m"
BIT := -m32
endif
else
ifneq "$(findstring -m,$(BIT))" "-m"
BIT := -m64
endif
endif
endif

#
# --- Windows
#
ifeq "$(findstring Windows,$(OS))" "Windows"
CC  	:= $(CC) $(BIT)
WINDRES := windres.exe
CFLAGS  += -std=c99
endif

#
# --- Linux 
#
ifeq "$(findstring Linux,$(OS))" "Linux"
CFLAGS += -fPIC -std=c99
endif

#
# --- Omit symbol information on release version
#
ifeq "$(build)" "release"
CC += -s 
endif

